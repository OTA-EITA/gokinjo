name: Weekly ETL Pipeline

on:
  schedule:
    - cron: '0 17 * * 0'  # Every Sunday at 2:00 AM JST (17:00 UTC)
  workflow_dispatch:       # Manual trigger

jobs:
  run-airflow-etl:
    runs-on: ubuntu-latest  # Change to 'self-hosted' when ready
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Check Airflow availability
        run: |
          echo "This is a placeholder for Airflow ETL automation"
          echo "To enable, switch to self-hosted runner and update this workflow"
          echo ""
          echo "Current ETL trigger method: Manual via 'make airflow-run-dag'"
          echo "Planned: Automatic weekly data refresh via self-hosted runner"
      
      - name: Create ETL summary
        run: |
          echo "## ETL Pipeline Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Current status: Manual execution required" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Next Steps" >> $GITHUB_STEP_SUMMARY
          echo "1. Set up self-hosted runner on development machine" >> $GITHUB_STEP_SUMMARY
          echo "2. Update workflow to use: runs-on: self-hosted" >> $GITHUB_STEP_SUMMARY
          echo "3. Enable Airflow service automation" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Manual Execution" >> $GITHUB_STEP_SUMMARY
          echo '```bash' >> $GITHUB_STEP_SUMMARY
          echo 'make airflow-start' >> $GITHUB_STEP_SUMMARY
          echo 'make airflow-run-dag DAG_ID=tokyo_districts_etl_unified' >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
