project:
  name: neighborhood-mapping-poc
  description: >
    æ±äº¬23åŒºã®ç”ºä¸ç›®å˜ä½ã§ã€Œå­¦æ ¡ Ã— æ²»å®‰ã€ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆãƒ»å¯è¦–åŒ–ã™ã‚‹PoCåŸºç›¤ã€‚
    æ®µéšçš„å®Ÿè£…ã«ã‚ˆã‚Šã€ãƒ‡ãƒ¢ç’°å¢ƒã‹ã‚‰æœ¬ç•ªé‹ç”¨ã¾ã§å¯¾å¿œã™ã‚‹ã€‚
  current_phase: "Phase 1: ãƒ‡ãƒ¢ç’°å¢ƒå®‰å®šåŒ–"

scope:
  target_region: tokyo-23-wards (ç¾åœ¨ã¯2åŒºã®ã‚µãƒ³ãƒ—ãƒ«)
  data_layers:
    - crime (ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿)
    - school (ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿)
  granularity: town-chome

architecture:
  # === PHASE 1: ç¾åœ¨ã®å®Ÿè£… (ãƒ‡ãƒ¢é‡è¦–) ===
  current_implementation:
    orchestration: 
      tool: manual_scripts  # Airflowã¯ç¬¬2æ®µéšã§å°å…¥
      note: "ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆã§ãƒ‡ãƒ¢ã«ç‰¹åŒ–"
    
    database:
      engine: postgresql
      extension: postgis
      docker_service: postgis
      port: 5432
      schemas:
        areas:
          columns:
            - id: serial
            - ward_code: text
            - town_code: text  
            - name: text
            - geom: polygon(4326)
            - created_at: timestamp
            - updated_at: timestamp
        schools:
          columns:
            - id: serial
            - name: text
            - type: enum [elementary, junior_high, high]
            - public_private: enum [public, private]
            - location: point(4326)
            - area_id: fk -> areas.id
            - address: text
            - created_at: timestamp
            - updated_at: timestamp
        crimes:
          columns:
            - id: serial
            - category: text
            - date: date
            - location: point(4326)
            - area_id: fk -> areas.id
            - description: text
            - created_at: timestamp
            - updated_at: timestamp

    api:
      protocol: http_rest  # å½“é¢ã¯HTTP RESTã€å°†æ¥gRPCã«ç§»è¡Œå¯èƒ½
      language: go
      port: 8081
      endpoints:
        - GET /health -> HealthResponse
        - GET /v1/areas -> AreaList
        - GET /v1/areas/{ward_code}/{town_code}/schools -> SchoolList
        - GET /v1/areas/{ward_code}/{town_code}/crimes -> CrimeList (å®Ÿè£…äºˆå®š)
        - GET /v1/schools/{id}/safety-score -> SafetyScore (å®Ÿè£…äºˆå®š)

    frontend:
      framework: react + leaflet
      serving: python_http_server (é–‹ç™ºç”¨)
      port: 3001
      features:
        implemented:
          - area_selection: ã‚¨ãƒªã‚¢é¸æŠUI
          - school_markers: å­¦æ ¡ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º
          - interactive_map: Leafletåœ°å›³è¡¨ç¤º
        todo:
          - crime_markers: çŠ¯ç½ªãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚«ãƒ¼
          - layer_toggle: ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡æ›¿æ©Ÿèƒ½
          - safety_score_display: å®‰å…¨æ€§ã‚¹ã‚³ã‚¢è¡¨ç¤º

    storage:
      minio:
        docker_service: minio
        console_port: 9001
        api_port: 9000
        credentials:
          user: minio
          password: minio123
        buckets:
          - tokyo-crime-school
        note: "ç¬¬2æ®µéšã§ETLãƒ‡ãƒ¼ã‚¿ä¿å­˜ã«ä½¿ç”¨äºˆå®š"

  # === PHASE 2: ãƒ‡ãƒ¼ã‚¿å‡¦ç†è‡ªå‹•åŒ– (é‹ç”¨æ¤œè¨¼) ===
  future_implementation:
    orchestration:
      tool: airflow
      executor: LocalExecutor â†’ KubernetesExecutor
      dag:
        name: tokyo_crime_school_etl
        schedule: daily
        structure:
          - download_raw_files
          - transform_by_ward
          - normalize_to_parquet
          - load_postgis
    
    etl:
      format: parquet
      staging: s3 (minio)
      process_flow:
        - raw: s3://tokyo-crime-school/raw
        - processed: s3://tokyo-crime-school/processed
        - curated: s3://tokyo-crime-school/curated

    api:
      protocol: grpc + grpc_gateway
      services:
        CrimeSchoolService:
          methods:
            - getSchoolsByArea(ward_code, town_code) -> SchoolList
            - getCrimesByArea(ward_code, town_code) -> CrimeList
            - getSafetyScore(school_id) -> SafetyScore

development:
  current:
    platform: docker-compose
    components:
      - postgis (PostgreSQL + PostGIS)
      - minio (S3äº’æ›ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸)
    manual_processes:
      - api_server: manual go run
      - frontend: manual python http.server
      - data_loading: SQL scripts
    
  phase1_improvements:
    - crime_endpoint: APIã«crimeã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 
    - layer_toggle: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡æ›¿è¿½åŠ 
    - safety_score: å­¦æ ¡å‘¨è¾ºçŠ¯ç½ªå¯†åº¦ç®—å‡º
    - docker_compose_integration: APIãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®DockeråŒ–

deployment:
  step1_current:
    platform: docker-compose (minimal)
    goal: stable demo environment
    status: âœ… å‹•ä½œä¸­
    
  step2_enhanced:
    platform: docker-compose (full stack)
    goal: complete local development
    status: ğŸ”„ ç¬¬1æ®µéšå®Œäº†å¾Œã«å®Ÿè£…
    
  step3_cloud_poc:
    platform: aws ecs fargate + rds + s3
    goal: realistic cloud demo
    status: âŒ ç¬¬2æ®µéšå®Œäº†å¾Œã«æ¤œè¨
    
  step4_production:
    platform: aws eks
    goal: scalable nationwide platform
    status: âŒ å°†æ¥è¨ˆç”»

sample_data:
  areas:
    - ward: "13101" (åƒä»£ç”°åŒº)
      town: "001" (ä¸¸ã®å†…)
    - ward: "13102" (ä¸­å¤®åŒº)  
      town: "001" (éŠ€åº§)
  schools: 2 schools with location data
  crimes: 2 sample crimes with location data

phase_decision_criteria:
  phase1_completion:
    - âœ… ç’°å¢ƒã®å®Œå…¨å®‰å®šåŒ–
    - âœ… çŠ¯ç½ªãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæ©Ÿèƒ½
    - âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡æ›¿æ©Ÿèƒ½
    - âœ… å®‰å…¨æ€§ã‚¹ã‚³ã‚¢è¡¨ç¤º
    - âœ… ãƒ‡ãƒ¢ç”¨ã®UI/UXå®Œæˆ
    
  phase2_triggers:
    - å®Ÿãƒ‡ãƒ¼ã‚¿APIé€£æºãŒå¿…è¦
    - è¤‡æ•°åŒºå¯¾å¿œãŒå¿…è¦
    - å®šæœŸãƒ‡ãƒ¼ã‚¿æ›´æ–°ãŒå¿…è¦
    - æœ¬æ ¼ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ¤œè¨¼ãŒå¿…è¦

next_actions:
  immediate:
    - environment_cleanup: make clean && make setup && make start
    - api_crime_endpoint: çŠ¯ç½ªãƒ‡ãƒ¼ã‚¿APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…
    - frontend_layer_toggle: ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡æ›¿UIå®Ÿè£…
    
  within_week:
    - safety_score_calculation: å­¦æ ¡å‘¨è¾ºçŠ¯ç½ªå¯†åº¦ç®—å‡º
    - demo_data_enhancement: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®å……å®Ÿ
    - documentation_update: ç¾çŠ¶åæ˜ ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
